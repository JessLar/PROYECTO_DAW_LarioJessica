<div class="usuarios-container">

  <div class="usuarios-list">

    <h1>Usuarios</h1>
    <button mat-raised-button color="primary" class="add-button" (click)="mostrarFormulario('add')">Añadir
      Usuario</button>
    <table mat-table [dataSource]="usuarios" class="mat-elevation-z8">
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> NOMBRE </th>
        <td mat-cell *matCellDef="let usuario"> {{usuario.nombre}} </td>
      </ng-container>
      <ng-container matColumnDef="apellido">
        <th mat-header-cell *matHeaderCellDef> APELLIDO </th>
        <td mat-cell *matCellDef="let usuario"> {{usuario.apellido}} </td>
      </ng-container>
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef> CORREO ELECTRONICO </th>
        <td mat-cell *matCellDef="let usuario"> {{usuario.email}} </td>
      </ng-container>
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="acciones"> ACCIONES </th>
        <td mat-cell *matCellDef="let usuario">
          <div class="icon-container">
            <button mat-icon-button (click)="verProyectos(usuario)">
              <mat-icon>visibility</mat-icon>
            </button>
            <span>Ver proyectos</span>
          </div>
          <div class="icon-container">
            <button mat-icon-button (click)="mostrarFormulario('asignarProyecto', usuario)">
              <mat-icon>add</mat-icon>
            </button>
            <span>Asignar proyecto</span>
          </div>
          <div class="icon-container">
            <button mat-icon-button (click)="mostrarFormulario('editar', usuario)">
              <mat-icon>edit</mat-icon>
            </button>
            <span>Editar</span>
          </div>
          <div class="icon-container">
            <button mat-icon-button (click)="eliminarUsuario(usuario.id)">
              <mat-icon>delete</mat-icon>
            </button>
            <span>Eliminar</span>
          </div>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <div *ngIf="formularioVisible" class="usuario-form">
    <mat-card>
      <mat-card-content>
        <form [formGroup]="usuarioForm" (ngSubmit)="submitForm()">
          <mat-form-field>
            <mat-label>Nombre de usuario</mat-label>
            <input matInput formControlName="username" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Contraseña</mat-label>
            <input matInput formControlName="password" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="nombre" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Apellido</mat-label>
            <input matInput formControlName="apellido" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Correo electrónico</mat-label>
            <input matInput formControlName="email" required>
          </mat-form-field>
          <div *ngIf="accion === 'add' || accion === 'editar'" class="imagen-upload">
            <label for="imagenPerfil">Imagen de perfil</label>
            <input type="file" id="imagenPerfil" (change)="onFileSelected($event)">
          </div>

          <div *ngIf="accion === 'add' || accion === 'editar'">
            <label>Rol</label>
            <mat-radio-group formControlName="rol">
              <mat-radio-button value="NORMAL">Normal</mat-radio-button>
              <mat-radio-button value="ADMIN">Administración</mat-radio-button>
            </mat-radio-group>
          </div>
          <mat-form-field *ngIf="accion === 'asignarProyecto'">
            <mat-label>Proyecto</mat-label>
            <mat-select formControlName="proyectoId">
              <mat-option *ngFor="let proyecto of proyectos" [value]="proyecto.idProyecto">{{ proyecto.nombreProyecto
                }}</mat-option>
            </mat-select>
          </mat-form-field>
          <div class="button-form">
            <button mat-raised-button color="primary" type="submit">{{ accion === 'add' ? 'Añadir' : 'Guardar'
              }}</button>
          </div>
          <button mat-button (click)="cancelar()">Cancelar</button>
        </form>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="mostrarProyectos" class="proyectos-asignados">
    <h4>Proyectos Asignados</h4>
    <ul *ngIf="proyectosAsignados.length > 0">
      <li *ngFor="let proyecto of proyectosAsignados"> {{ proyecto.proyecto.nombreProyecto }} - {{proyecto.proyecto.descripcionProyecto }} </li>
    </ul>
    <p *ngIf="proyectosAsignados.length === 0">   No existen proyectos asignados a esta usuaria. </p>
    <button mat-button (click)="cerrarProyectosAsignados()">Volver</button>
  </div>
</div>